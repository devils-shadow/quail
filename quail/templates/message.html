{% extends "layout.html" %}
{% block content %}
{% set inbox_query = "" %}
{% if current_inbox %}
{% set inbox_query = "?inbox=" ~ (current_inbox | urlencode) %}
{% endif %}
<div class="message-header">
  <div class="breadcrumb">
    <strong>Public Message</strong>
    <span>â€º</span>
    {{ message.subject or "(No subject)" }}
  </div>
</div>

<details class="card message-details" open>
  <summary class="message-details__summary">
    <span>Message details</span>
    <span class="row-muted">To {{ message.envelope_rcpt }}</span>
    <span class="message-details__actions">
      {% if is_admin %}
      <form method="post" action="/admin/message/{{ message.id }}/delete">
        <button class="button secondary" type="submit">Delete</button>
      </form>
      {% endif %}
      <a class="button secondary" href="/inbox{{ inbox_query }}">Back to Inbox</a>
    </span>
  </summary>
  <div class="details-grid compact three-col">
    <dl>
      <dt>To</dt>
      <dd>{{ message.envelope_rcpt }}</dd>
      <dt>From</dt>
      <dd>{{ message.from_addr or "Unknown" }}</dd>
    </dl>
    <dl>
      <dt>Date</dt>
      <dd>{{ message.date or "Unknown" }}</dd>
      <dt>Received</dt>
      <dd>{{ message.received_at }}</dd>
    </dl>
    <dl>
      <dt>Message ID</dt>
      <dd>{{ message.message_id or "Unknown" }}</dd>
      <dt>Size</dt>
      <dd>{{ message.size_bytes }} bytes</dd>
      {% if is_admin %}
      <dt>Quarantined</dt>
      <dd>{{ "Yes" if message.quarantined else "No" }}</dd>
      {% endif %}
    </dl>
  </div>
</details>

<div class="card tabs-container">
  <div class="tabs" data-tabs>
    {% if allow_html and html_body %}
    <button class="tab active" type="button" data-tab="html" aria-selected="true">
      HTML{% if allow_rich_html %} (Rich){% endif %}
    </button>
    <button class="tab" type="button" data-tab="text" aria-selected="false">TEXT</button>
    {% else %}
    <button class="tab active" type="button" data-tab="text" aria-selected="true">TEXT</button>
    {% endif %}
    <button class="tab" type="button" data-tab="attachments" aria-selected="false">ATTACHMENTS</button>
  </div>
  <div class="message-body tab-panels">
    {% if allow_html and html_body %}
    <section class="tab-panel active" data-tab-panel="html">
      <div class="message-html{% if allow_rich_html %} message-html--rich{% endif %}">
        {{ html_body | safe }}
      </div>
    </section>
    <section class="tab-panel" data-tab-panel="text">
      <pre>{{ body }}</pre>
    </section>
    {% else %}
    <section class="tab-panel active" data-tab-panel="text">
      <pre>{{ body }}</pre>
    </section>
    {% endif %}

    <section class="tab-panel" data-tab-panel="attachments">
      {% if attachments %}
      <ul>
        {% for attachment in attachments %}
        <li>{{ attachment.filename }} ({{ attachment.content_type }}, {{ attachment.size }} bytes)</li>
        {% endfor %}
      </ul>
      {% else %}
      <p class="row-muted">No attachments.</p>
      {% endif %}
    </section>
  </div>
</div>
{% endblock %}
