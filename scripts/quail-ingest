#!/usr/bin/env bash
set -euo pipefail

VENV_PYTHON="/opt/quail/venv/bin/python"
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
REPO_ROOT="$(dirname "${SCRIPT_DIR}")"

if [[ ! -x "${VENV_PYTHON}" ]]; then
  message="ERROR: ${VENV_PYTHON} not found or not executable; cannot run quail.ingest."
  echo "${message}" >&2
  if command -v logger >/dev/null 2>&1; then
    logger -t quail-ingest "${message}"
  fi
  exit 1
fi

# Ensure the repo root is on PYTHONPATH; Quail is not installed as a package.
exec env PYTHONPATH="${REPO_ROOT}${PYTHONPATH:+:${PYTHONPATH}}" \
  "${VENV_PYTHON}" -m quail.ingest "$@"
